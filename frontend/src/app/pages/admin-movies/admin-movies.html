<div class="main-container">
  <div class="header-section" style="display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h2>Movie Management</h2>
      <span *ngIf="isAdmin" class="admin-badge">ADMIN MODE</span>
    </div>
    
    <button *ngIf="isAdmin" (click)="toggleStats()" style="background: #f1c40f; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; color: #222;">
      {{ showStats ? 'Hide Report' : ' View Top Revenue' }}
    </button>
  </div>

  <div *ngIf="showStats && isAdmin" style="background: #2c3e50; padding: 20px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #f1c40f;">
    <h3 style="color: #f1c40f; margin-top: 0;">Top Performers (Revenue > Average)</h3>
    <table style="width: 100%; color: white; border-collapse: collapse;">
      <thead>
        <tr style="border-bottom: 2px solid #555;">
          <th style="padding: 10px; text-align: left;">Movie Title</th>
          <th style="padding: 10px; text-align: right;">Total Revenue</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of topRevenueMovies" style="border-bottom: 1px solid #444;">
          <td style="padding: 10px;">{{ item.name }}</td>
          <td style="padding: 10px; text-align: right; color: #2ecc71; font-weight: bold;">{{ item.total_revenue }} RON</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="isAdmin" class="add-form-container">
    <h3>+ Add New Movie</h3>
    <div class="form-inputs">
      <div class="form-row">
        <input type="text" [(ngModel)]="inputTitle" placeholder="Movie Title" class="form-control" style="flex: 2;">
        <input type="number" [(ngModel)]="inputYear" placeholder="Year" class="form-control small">
        <input type="text" [(ngModel)]="inputGenre" placeholder="Genre" class="form-control" style="flex: 1;">
      </div>
      <div class="form-row">
        <input type="number" [(ngModel)]="inputDuration" placeholder="Duration (min)" class="form-control small">
        <input type="number" step="0.1" [(ngModel)]="inputRating" placeholder="Rating" class="form-control small">
        <input type="text" [(ngModel)]="inputPoster" placeholder="Poster URL" class="form-control" style="flex: 2;">
      </div>
      <div class="form-row">
        <textarea [(ngModel)]="inputDescription" placeholder="Description..." class="form-control full-width" rows="2"></textarea>
      </div>
      <div class="form-row" style="justify-content: flex-end;">
        <button (click)="onAddMovie()" class="btn-add">Save Movie</button>
      </div>
    </div>
  </div>

  <div class="movies-list">
    <div *ngFor="let movie of movies" class="movie-card">
      <div class="movie-poster">
        <img [src]="movie.posterUrl || 'https://via.placeholder.com/150x220?text=No+Poster'">
      </div>

      <div class="movie-details">
        <div class="title-row">
          <h3 class="movie-title">{{ movie.name }}</h3>
          <span class="rating-star">‚òÖ {{ movie.rating }}</span>
        </div>
        <p class="description-text">{{ movie.description }}</p>

        <div class="admin-projections-box">
          <h4 class="box-title">SCHEDULE & LOCATIONS</h4>
          
          <div class="current-slots">
            <div *ngFor="let p of movie.projections" class="slot-badge">
              <div *ngIf="editingProjectionId !== p.id" class="slot-content">
                <span class="slot-date">{{ p.date }}</span>
                <span class="slot-time">{{ p.time }}</span>
                <span class="divider">|</span>
                <span class="slot-hall">H{{ p.hall_nr }}</span>
                <span class="format-tag" [ngClass]="p.projection_type">{{ p.projection_type }}</span>
                <span class="slot-city">{{ p.city }}</span>
                <button (click)="onEditProjection(p)" class="btn-action-small">‚úèÔ∏è</button>
                <button (click)="onDeleteProjection(p.id)" class="btn-delete-slot">√ó</button>
              </div>

              <div *ngIf="editingProjectionId === p.id" class="edit-slot-row">
                <input type="date" [(ngModel)]="p.editDate" class="mini-input">
                <input type="time" [(ngModel)]="p.editTime" class="mini-input">
                <select [(ngModel)]="p.editHallId" class="mini-input">
                  <option *ngFor="let h of halls" [ngValue]="h.id">H{{h.hall_nr}} - {{h.city}}</option>
                </select>
                <button (click)="onUpdateProjection(p)" class="btn-save-small">OK</button>
                <button (click)="editingProjectionId = null" class="btn-cancel-small">Cancel</button>
              </div>
            </div>
          </div>   

          <div class="add-slot-form" *ngIf="!editingProjectionId">
            <input type="date" [(ngModel)]="movie.draftDate" class="mini-input">
            <input type="time" [(ngModel)]="movie.draftTime" class="mini-input">
            <select [(ngModel)]="movie.draftHallId" class="mini-input select-hall">
              <option [ngValue]="null">Select Hall & Location</option>
              <option *ngFor="let h of halls" [ngValue]="h.id">
                H{{ h.hall_nr }} ({{ h.hall_type }}) - {{ h.city }}
              </option>
            </select>
            <button (click)="onAddProjection(movie)" class="btn-add-slot">Add</button>
          </div>
        </div>
      </div>

      <div class="movie-actions" *ngIf="isAdmin">
        <button (click)="onDeleteMovie(movie.id!)" class="btn-delete-movie">üóëÔ∏è</button>
      </div>
    </div>
  </div>
</div>